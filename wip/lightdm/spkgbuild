# description	: Lightweight display manager based upon GTK
# backup	: etc/lightdm/keys.conf etc/lightdm/lightdm.conf etc/lightdm/users.conf etc/lightdm/Xsession
# depends	: glib glibc libgcrypt linux-pam polkit pcre libxklavier
# makedepends	: itstool vala gobject-introspection

name=lightdm
version=1.24.0
release=1
source=(https://launchpad.net/lightdm/${version::4}/$version/+download/$name-$version.tar.xz
	Xsession
	rc.lightdm)

build() {
	cd $name-$version

	ITSTOOL=/bin/true                    \
	./configure                          \
	       --prefix=/usr                 \
	       --libexecdir=/usr/lib/lightdm \
	       --localstatedir=/var          \
	       --sbindir=/usr/bin            \
	       --sysconfdir=/etc             \
	       --disable-static              \
	       --disable-tests               \
	       --with-greeter-user=lightdm   \
	       --with-greeter-session=lightdm-gtk-greeter
	make
	make DESTDIR=$PKG install

	install -m 755 $SRC/Xsession $PKG/etc/lightdm/Xsession
	sed -i 's|#session-wrapper=lightdm-session|session-wrapper=/etc/lightdm/Xsession|' \
		$PKG/etc/lightdm/lightdm.conf

	#sed '\@/bin/sh@a\
	#\
	#. /etc/profile' tests/src/lightdm-session > $PKG/usr/bin/lightdm-session

	install -Dm755 $SRC/rc.lightdm $PKG/etc/rc.d/rc.lightdm

	cp tests/src/lightdm-session $PKG/usr/bin
	rm -rf $PKG/etc/init

	install -v -dm755 -o lightdm -g lightdm $PKG/var/lib/lightdm
	install -v -dm755 -o lightdm -g lightdm $PKG/var/lib/lightdm-data
	install -v -dm755 -o lightdm -g lightdm $PKG/var/cache/lightdm
	install -v -dm770 -o lightdm -g lightdm $PKG/var/log/lightdm
}
