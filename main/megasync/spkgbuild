# description	: Easy automated syncing between your computers and your MEGA cloud drive 
# homepage	: https://github.com/meganz/MEGAsync
# depends	: c-ares crypto++ libsodium libuv libmediainfo libraw qt5 swig sed lsb-release freeimage

name=megasync
version=4.5.3.0
release=1
sdkver=3.8.2c
source="https://github.com/meganz/MEGAsync/archive/refs/tags/v${version}_Linux.tar.gz
        https://github.com/meganz/sdk/archive/refs/tags/v$sdkver.tar.gz
        megasync-4.5.0.0_ffmpeg.patch
        megasync-4.5.0.0_pdfium.patch"

build() {
	mv sdk-$sdkver/* MEGAsync-${version}_Linux/src/MEGASync/mega

	cd MEGAsync-${version}_Linux
	patch -p1 < $SRC/megasync-4.5.0.0_ffmpeg.patch
	cd src/MEGASync/mega
	patch -p1 < $SRC/megasync-4.5.0.0_pdfium.patch

	./autogen.sh
	./configure \
	--prefix=/usr \
	--sysconfdir=/etc \
	--localstatedir=/var \
	--with-cares \
	--with-cryptopp \
	--with-curl \
	--with-sodium \
	--with-sqlite \
	--with-zlib \
	--with-termcap \
	--with-freeimage \
	--enable-chat 

	cd ../../
	qmake CONFIG+="release" MEGA.pro
	lrelease MEGASync/MEGASync.pro
	make
	
	install -m 755 -p -D MEGASync/megasync $PKG/usr/bin/megasync
	install -m 644 -p -D MEGASync/platform/linux/data/megasync.desktop $PKG/usr/share/applications/megasync.desktop
	install -m 644 -p -D MEGASync/platform/linux/data/icons/hicolor/16x16/apps/mega.png $PKG/usr/share/icons/hicolor/16x16/apps/mega.png
	install -m 644 -p -D MEGASync/platform/linux/data/icons/hicolor/32x32/apps/mega.png $PKG/usr/share/icons/hicolor/32x32/apps/mega.png
	install -m 644 -p -D MEGASync/platform/linux/data/icons/hicolor/48x48/apps/mega.png $PKG/usr/share/icons/hicolor/48x48/apps/mega.png
	install -m 644 -p -D MEGASync/platform/linux/data/icons/hicolor/128x128/apps/mega.png $PKG/usr/share/icons/hicolor/128x128/apps/mega.png
	install -m 644 -p -D MEGASync/platform/linux/data/icons/hicolor/256x256/apps/mega.png $PKG/usr/share/icons/hicolor/256x256/apps/mega.png
}
