# description	: Lightweight Display Manager for the LXDE desktop
# homepage	: http://lxde.org/
# maintainer	: Emmett1, emmett1.2miligrams at gmail.com
# backup	: etc/lxdm/lxdm.conf
# depends	: gtk3 iso-codes consolekit2 linux-pam xorg-server librsvg

name=lxdm
version=0.5.3
release=5
source=(http://downloads.sourceforge.net/$name/$name-$version.tar.xz
	run)
md5sum=(061caae432634e6db38bbdc84bc6ffa0
	5b9c5683ea65eb376d7c52ca3c68c471)

build() {
	cd $name-$version

cat > pam/lxdm << "EOF"
# Begin /etc/pam.d/lxdm

auth     requisite      pam_nologin.so
auth     required       pam_env.so
auth     include        system-auth

account  include        system-account

password include        system-password

session  required       pam_limits.so
session  include        system-session

# End /etc/pam.d/lxdm
EOF

sed -i 's:sysconfig/i18n:profile.d/i18n.sh:g' data/lxdm.in
sed -i 's:/etc/xprofile:/etc/profile:g' data/Xsession
sed -e 's/^bg/#&/'        \
    -e '/reset=1/ s/# //' \
    -e 's/logou$/logout/' \
    -e "/arg=/a arg=/usr/bin/X" \
    -i data/lxdm.conf.in

	./configure --prefix=/usr     \
	            --sysconfdir=/etc \
	            --with-pam        \
		    --disable-nls     \
		    --enable-gtk3     \
	            --with-systemdsystemunitdir=no
	make
	make DESTDIR=$PKG install

	# runit service
	install -Dm755 $SRC/run $PKG/etc/sv/lxdm/run
	ln -s /run/runit/supervise.lxdm $PKG/etc/sv/lxdm/supervise
}
